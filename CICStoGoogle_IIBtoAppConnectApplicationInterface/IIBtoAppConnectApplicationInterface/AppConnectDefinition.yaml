swagger: '2.0'
info:
  title: IIB Interface to Member DBStore for App Connect
  description: Generated by IIB pattern generator
  version: 1.0.0
host: cap-au-sg-prd-03.integration.ibmcloud.com:15036
schemes:
  - http
basePath: /
produces:
  - application/json

x-hooks:
  IIB Interface for App Connect:
    description: Events originating from the IIB Interface for App Connect application
    x-register-subscription:   insuranceSubscribeOperation
    x-list-all-subscriptions:  insuranceSubscriptionListOperation
    x-deregister-subscription: insuranceUnsubscribeOperation
    x-change-subscription:     insuranceChangeSubscribeOperation
    x-retrieve-subscription:   insuranceRetrieveSubscribeOperation
    x-events:
      newMember:
        description: 'Notification Event for new Member syncing CICS to DB2 on prem'
        x-eventId: 'newMember'
        parameters:
            - name: event
              in: body
              required: true
              schema:
                $ref: '#/definitions/Product'

paths:
  /user01/insurance/member/hook:
    post:
      operationId: 'insuranceSubscribeOperation'
      summary: Create a subscription to webhook for insurance member
      description: |
        Call this API to create a new subscription on the webhook. Provide a list of events to subscribe for and a HTTP callback URL.
      parameters:
        - name: subscription
          in: body
          description: Details to subscribe for a callback on a given set of events
          required: true
          schema:
            $ref: '#/definitions/Subscription'

      tags:
        - Webhook
      responses:
        '202':
          description: Details of the subscription created to the webhook
          schema:
            $ref: '#/definitions/Subscribe_response'

    get:
      operationId: 'insuranceSubscriptionListOperation'
      summary: Get a list of subscriptions on webhook for insurance member
      description: |
        Call this API to get a list of subscriptions defined for this webhook
      tags:
        - Webhook
      responses:
        '200':
          description: Ids of all subscriptions setup for this webhook
          schema:
            type: array
            items:
              type: string

  /user01/insurance/member/hook/{id}:
    delete:
      operationId: 'insuranceUnsubscribeOperation'
      summary: Delete a subscription to the webhook for insurance member
      description: |
        Call this API to delete a subscription call id on the webhook.
      parameters:
        - name: id
          in: path
          description: Subscription to delete
          required: true
          type: number
      tags:
        - Webhook
      responses:
        '204':
          description: Details of the subscription created to the webhook

    get:
      operationId: 'insuranceRetrieveSubscribeOperation'
      summary: Get details of a subscription to webhook
      description: |
        Call this API to get details of a subscription for insurance member.
      parameters:
        - name: id
          in: path
          description: Subscription to get
          required: true
          type: number
      tags:
        - Webhook
      responses:
        '200':
          description: Details of the subscription created to the webhook
          schema:
            $ref: '#/definitions/Subscription'

    put:
      operationId: 'insuranceChangeSubscribeOperation'
      summary: Change details of a subscription to webhook for insurance member
      description: |
        Call this API to change details of a subscription.
      parameters:
        - name: id
          in: path
          description: Subscription to change
          required: true
          type: string
        - name: subscription
          in: body
          description: New subscription details
          required: true
          schema:
            $ref: '#/definitions/Subscription'
      tags:
        - Webhook
      responses:
        '204':
          description: Change successful

definitions:
  Subscription:
    type: object
    properties:
      callback:
        $ref: '#/definitions/Callback_details'
        description: 'Details about how to callback when an event occurs'
      event_types:
        type: array
        items:
          type: string

  Callback_details:
    type: object
    properties:
      url:
        type: string
        description: 'url to callback on'
      secret:
        type: string
        description: 'secret to use in callback'

  Subscribe_response:
    type: object
    properties:
      id:
        type: number
        description: 'Unique identifier representing the subscription to the webhook'

  Product:
    type: object
    properties:
      policynum:
        type:  string
      policytype:
        type:  string
      firstname:
        type:  string
      lastname:
        type:  string
      streetnum:
        type:  string
      streetname:
        type:  string
      city:
        type:  string
      pcode:
        type:  string
      age:
        type:  string
